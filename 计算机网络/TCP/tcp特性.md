# tcp主要特性

tcp主要特性：tcp重传、滑动窗口、流量控制、拥塞控制

为了保证可靠性性，用了以上机制。

## 重传

tcp实现可靠传输的方式之一，通过序列号和确认应答实现。

当发送端数据到达接收端，接收络中，数据传输失败的情况很多，所以需要多种方案分别应对。

- 超时重传
- 快速重传
- SACK
- D-SACK

### 超时重传

在发送数据时，设置定时器，超过指定时间没收到ack，就重传数据。

超时重传情况： 数据包丢失、ack包丢失

- 超时时间的设置
  - RTT：数据发送时刻到接受到ack的时刻的差值，也就是包的往返时间
    - 当超时时间过大时，重传慢，效率低
    - 当超时时间过小时，可能包没丢就重传了，导致网络资源浪费
  - 所以超时时间应该略大于RTT，并且由于RTT是一个根据网络动态变化的值，所以超时时间也要可以动态变化
  - Linux的实现：
    - 通过TCP采用RTT时间，进行加权平均算出平滑RTT。
    - 采样RTT和RTT的波动范围，避免RTT有大波动
  - 如果超时数据再次超时，那么超时时间加倍。避免频繁重发。

### 快速重传

快速重传机制不以时间为驱动，而是以数据为驱动

工作方式：当收到三个以上相同ack时，说明当前报文缺失。在定时器过期之前，将重传丢失的报文段。

例：一段报文分4段发，其中第2、3、4段收到，但是第1段没有收到，就会返回3个ack1表示ack1没有收到。发送端此时会重发第一段，接收端收到后就会返回ack5表示四段都收到了

### SACK方法

SACK：选择性确认机制

该方式需要再tcp头部加SACK字段，它将已接受数据发给发送端，然后让发送端只重传丢失的数据

Linux可以使用net.ipv4.tcp_sack

Linux2.4后默认打开该功能。

### Duplicate-SACK

也叫D-SACK，通过ack和sack的值判断信息，告诉发送方哪些数据重复

- ACK丢包
  - 接受方收到两个包1，2，但是发给发送方的两个ack丢失，发送方重传
  - 接受方发现数据重复，返回sack1和ack2
  - 发送方收到后就可以得知：数据包1和2都收到了
- 网络延时
  - 因为网络延时，发送方没有收到数据包2
  - 之后接受方就返回了三个相同的ack2和sack3，4，5
  - 但是重传后，被延迟的数据包到了，接受方回复sack2
  - 这样接受方就可以得到数据包2是网络延迟

DACK的好处：

- 让发送方知道发出的包丢了，还是ack包丢了
- 可以知道发出的包是否网络延时了
- 网络是否将发送方数据包复制

Linux可以使用net.ipv4.tcp_dsack

Linux2.4后默认打开该功能。

## 滑动窗口
