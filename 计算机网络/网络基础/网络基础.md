[TOC]

# 网络基础

- 同一台设备上的进程间通信，有很多种方式，比如有管道、消息队列、共享内存、信号等方式
- 不同设备上的进程间通信，就需要网络通信，而设备是多样性的，所以要兼容多种多样的设备，就协商出了一套通用的网络协议

这个网络协议是分层的，接下来根据TCP/IP协议对每层介绍

## 网络模型
### 应用层
- 这是模型的最上层，如应用软件都是在应用层实现的。
  当两个不同设备的应用需要通信的时候，应用就讲数据传给下一层，也就是传输层
- 所以，应用层只专注于为用户提供应用功能，如HTTP、FTP、Telenet、DNS等
- 应用层不用关心数据的传输，只负责将数据交给传输层即可
- 应用层是工作在操作系统中的用户态，传输层及以下则是工作在内核态
  
### 传输层
- 应用层数据会传给传输层，传输层就是为应用层提供网络支持的
    这一层有两个传输协议 TCP和UDP
- TCP：传输控制协议，大部分应用使用TCP传输协议，如HTTP应用层协议
  TCP比UDP多很多特性，如流量控制、超时重传、拥塞控制等，都是为了保证数据包能可靠地传输给对方。
- UDP相对简单，只发送数据包，不保证确认抵达。但是实时性更好，传输效率更好。
  但是其实UDP也可以做到可靠传输，将TCP的特性在应用层上实现就行，不过要实现可靠UDP传输协议不简单。
- 应用要传输的数据可能很大，直接传输不好控制，一般大小超过MSS（TCP最大报文段长度），就要进行数据分块。这样传输失败时可以只重复发送一个分块数据，这个分块叫做TCP段
- 当设备作为接受方时，传输层负责将数据传给应用，但一台设备可能接受到很多应用的数据，因此要用一个编号将应用区分，这个编号就是端口
- 80是web服务器使用，22端口是远程登录服务器使用。对于浏览器中的每个标签栏都有独立进程，操作系统会分配临时端口
- 传输层报文会携带端口号，便于接收方识别报文去哪个应用

### 网络层
  传输层其实并不负责将数据从一个设备传输到另一个设备。
  
  实际场景中的网络环节错综复杂，各种线路分叉，如果设备数据要传输给另一设备，要在各种的路径节点进行选择，而传输层的设计理念是简单、高效、专注，如果传输层还负责这块功能就违背了设计原则
  
  也就是说，不希望传输层负责这么多事，只要服务好应用让其成为应用间数据传输的媒介，帮助实现应用到应用的通信。实际传输功能交给下一层，网络层。

- 网络层最常用协议IP协议，IP协议将传输层报文作为数据部分，加上IP包头组装成IP报文，如果IP报文大小超过MTU（以太网中一般为 1500 字节）会再次分片，得到将发送到网络的IP报文。
- 网络层负责将数据传输到另一设备，该如何找到对方？网络层需要有区分设备的编号。
- 一般用IP地址给设备编号，对于IPv4，IP地址共32位，分四段。但单纯的 IP 地址虽然区分了设备，但是寻址特别麻烦，一个一个匹配不科学
  所以将IP地址分为两种意义，
    - 一个是网络号，负责标识IP属于哪个子网
    - 一个是主机号，负责标识同一子网下的不同主机
    - 通过配合子网掩码来算出IP地址的网络号和主机号，为了简化子网掩码的表示，255.255.255.0可以表示为 /24 
    - 网络地址和主机地址计算方式：
      - 将IP地址和子网掩码进行按位与运算得到网络号
      - 将子网掩码取反后与IP地址进行按位与运算得到主机号
  
- IP除了寻址还有路由功能。设备不只是用网线连接的，而是有很多网关、路由器、交换机等设备连接，会形成很多路径，将数据发送到一个节点需要通过路由算法决定走那条路径
- 路由寻址就是先找到目标的子网，再将数据发送到对应网络。所以IP协议的寻址就是告诉我们去往下一个目的地该往哪去，路由是按照下一个目的地选中路径。寻址像是导航，路由像是方向盘
  
### 网络接口层
- 生成IP头部后，接下来要交给网络接口层，在IP头部加MAC头部，并封装成数据帧发送到网络上。
- 因为IP头部的接收方IP地址表示包的目的地的方式在以太网中就无法使用了，因为以太网判断包位置的方式和IP不同，以太网要用到MAC地址进行通信。MAC头部是以太网使用的头部，包含了接收方和发送方的MAC地址信息，可以通过ARP协议获取对方的MAC地址

所以，**网络接口层主要是为网络层提供链路传输服务，负责在以太网、wifi这样的网络上发送数据包，工作在网卡层次，用MAC地址表示网络上的设备**

### 总结
综上所述，TCP/IP网络通畅分为从上到下4层，分为应用层、传输层、网络层、网络接口层。

网络接口层传输单位：  帧
IP层传输单位：包
TCP层传输单位： 段
HTTP传输单位： 消息/报文