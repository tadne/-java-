# 有了HTTP，要RPC干什么？

### TCP
TCP面向连接、可靠、基于字节流。
- 基于字节流
  - 字节流可以理解为双向的通道中的数据，纯TCP收发的数据是没有边界的，也就是不知道那些消息时完整消息
  - 例如：你要发送“我是XXX”，可能会收到“XXX是我”这种情况，无法区分，这就是粘包问题。
  - 纯TCP不能直接使用，要在这个基础上加自定义规则区分消息边界，这就是HTTP请求头的内容了
  - 每个TCP项目都定义了类似边界，也就是衍生出来的协议，如HTTP、RPC等

### HTTP和RPC
TCP是传输层协议，基于TCP造出来的HTTP和各类RPC协议都只是定义了不同消息格式的应用层协议而已。

HTTP协议：超文本传输协议。
RPC：远程过程调用，它不是一个具体协议，只是一种调用方式。
- 例：本地方法调用时，可以直接调用。但是如果是远端服务器暴露的方法，如果还想和本地方法调用方式一致怎么办？
- 这时就需要屏蔽一些网络远程调用的细节了，基于此，创造出了很多RPC协议，如gRPC、thrift等
- 虽然大部分RPC协议底层使用的是TCP，但不是一定要用TCP，可以使用UDP、HTTP一样做到，效果功能不会改变

### 有了HTTP，为什么还要RPC？
TCP是70年代的协议，HTTP是90年代流行的。这中间就有了80年代流行的RPC协议。

现在的联网软件，其实大都是客户端，要和服务端建立连接收发消息，要用到应用层协议，这种架构就可以使用RPC协议，因为它只和公司服务器交互即可

但是浏览器这个软件不同，它必须要能访问自家公司服务器，还要访问其他公司服务器，要有个统一标准，HTTP协议即使统一Browser/Server（BS）协议

也就是说，多年前**HTTP主要用于BS架构，RPC用于CS架构**。现在分的没那么清了，BS和CS在融合，很多软件支持多端，网页、百度云盘等

### HTTP和RPC的区别
- 服务发现
  - 建立连接的前提是IP地址和端口，这个找IP和端口的过程就是服务发现
  - HTTP中知道域名，再通过DNS解析IP地址，默认80端口
  - RPC有专门的中间服务保存服务名和IP，访问某个服务就去中间服务获取IP和端口。
- 底层连接方式
  - HTTP1.1主流协议默认建立TCP连接后保持这个连接（KeepAlive）
  - RPC协议和HTTP类似，也通过TCP长连接进行数据交互
    - RPC还会建立连接池，请求量大的时候，建立多条连接放池中，发数据时取出连接，用完再放回去复用
    - HTTP连接池很多编程语言网络库都有，如Go
- 传输的内容
  - TCP传输的消息： 消息头+消息体
    - 消息头：特殊信息，其中最重要的是消息体长度 
    - 消息体：传输数据的内容。
      - 一般是json格式，将这种格式转换为二进制形式的过程叫序列化，反之为反序列化。
      - 主流的HTTP1，虽然是超文本协议，但是最早是用来做网页文本显示的，而且里面数据很冗余
  - RPC类似定制化协议，自由度高，一般不需要像HTTP一样考虑那么多浏览器行为，很多消息头信息是不需要的，

### 总结
- 纯TCP是收发数据，是无边界数据流，需要定义消息边界，HTTP和RPC就是用来做这个的
- RPC本质不是协议，是一种调用方式，只有像gRPC、Thrift这种具体实现才是协议
- HTTP主要用于BS架构，RPC主要用于CS架构
- HTTP2在HTTP1基础上有很多优化，性能比很多RPC协议还好，况且现在有了HTTP3。但是取代RPC协议还要很长一段时间